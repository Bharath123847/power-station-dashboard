<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hybrid Power Station - Live Monitor</title>
    <style>
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            padding: 20px; 
            background-color: #f4f7f6; 
            text-align: center; 
            color: #333;
        }
        h1 { color: #0056b3; margin-bottom: 10px; }
        p { color: #666; margin-top: 0; }
        
        .container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            max-width: 900px;
            margin: 0 auto;
        }

        .card { 
            background: white; 
            padding: 20px; 
            margin: 15px; 
            border-radius: 15px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.05); 
            width: 260px;
            transition: transform 0.2s;
        }
        .card:hover { transform: translateY(-5px); }

        .label { 
            color: #888; 
            font-size: 0.85em; 
            text-transform: uppercase; 
            letter-spacing: 1px; 
            margin-bottom: 10px;
        }
        .value { 
            font-size: 2.2em; 
            font-weight: bold; 
            color: #333; 
        }
        .unit { font-size: 0.4em; color: #999; vertical-align: super;}
        .sub-value { font-size: 0.9em; color: #555; margin-top: 5px; }

        /* Specific Colors */
        .status-on { color: #28a745; }
        .status-off { color: #dc3545; }
        .batt-text { color: #007bff; }

        .footer { margin-top: 40px; font-size: 0.8em; color: #aaa; }
    </style>
</head>
<body>

    <h1>âš¡ Hybrid Power Station</h1>
    <p>Live Remote Monitoring</p>

    <div class="container">
        
        <div class="card">
            <div class="label">System Output</div>
            <div class="value" id="relay-status">--</div>
        </div>

        <div class="card">
            <div class="label">Battery Status</div>
            <div class="value batt-text">
                <span id="batt-voltage">--</span><span class="unit">V</span>
            </div>
            <div class="sub-value">
                <span id="batt-percent">--</span>% Charged
            </div>
        </div>

        <div class="card">
            <div class="label">Solar Input</div>
            <div class="value">
                <span id="solar-voltage">--</span><span class="unit">V</span>
            </div>
            <div class="sub-value">
                <span id="solar-current">--</span> mA
            </div>
        </div>

        <div class="card">
            <div class="label">Wind Input</div>
            <div class="value">
                <span id="wind-voltage">--</span><span class="unit">V</span>
            </div>
            <div class="sub-value">
                <span id="wind-current">--</span> mA
            </div>
        </div>

        <div class="card">
            <div class="label">Load Output</div>
            <div class="value">
                <span id="load-voltage">--</span><span class="unit">V</span>
            </div>
            <div class="sub-value">
                <span id="load-current">--</span> mA
            </div>
        </div>

    </div>

    <div class="footer" id="last-update">Updating...</div>

    <script>
        // --- CONFIGURATION ---
        const AIO_USERNAME = "YOUR_ADAFRUIT_USERNAME"; // <<< REPLACE THIS
        const AIO_KEY = "YOUR_ADAFRUIT_IO_KEY";       // <<< REPLACE THIS
        // ---------------------

        async function fetchData(feedName) {
            const url = `https://io.adafruit.com/api/v2/${AIO_USERNAME}/feeds/${feedName}/last`;
            try {
                const response = await fetch(url, { headers: { "X-AIO-Key": AIO_KEY } });
                const data = await response.json();
                return data.value;
            } catch (error) { console.error(error); return null; }
        }

        async function updateDashboard() {
            // Battery
            let battV = await fetchData('battery-voltage');
            if(battV) {
                document.getElementById('batt-voltage').innerText = parseFloat(battV).toFixed(1);
                let v = parseFloat(battV);
                let p = 0;
                if (v >= 12.7) p = 100; else if (v <= 11.7) p = 0; 
                else p = Math.round(((v - 11.7) / (12.7 - 11.7)) * 100);
                document.getElementById('batt-percent').innerText = p;
            }

            // Relay
            let relay = await fetchData('relay-status');
            let relEl = document.getElementById('relay-status');
            if(relay == '1') { relEl.innerText = "ON"; relEl.className = "value status-on"; }
            else { relEl.innerText = "OFF"; relEl.className = "value status-off"; }

            // Solar
            let solV = await fetchData('solar-voltage');
            let solA = await fetchData('solar-current');
            if(solV) document.getElementById('solar-voltage').innerText = parseFloat(solV).toFixed(1);
            if(solA) document.getElementById('solar-current').innerText = parseFloat(solA).toFixed(0);

            // Wind
            let wndV = await fetchData('wind-voltage');
            let wndA = await fetchData('wind-current');
            if(wndV) document.getElementById('wind-voltage').innerText = parseFloat(wndV).toFixed(1);
            if(wndA) document.getElementById('wind-current').innerText = parseFloat(wndA).toFixed(0);

            // Load
            let ldV = await fetchData('load-voltage');
            let ldA = await fetchData('load-current');
            if(ldV) document.getElementById('load-voltage').innerText = parseFloat(ldV).toFixed(1);
            if(ldA) document.getElementById('load-current').innerText = parseFloat(ldA).toFixed(0);

            // Time
            let now = new Date();
            document.getElementById('last-update').innerText = "Last Updated: " + now.toLocaleTimeString();
        }

        window.onload = updateDashboard;
        setInterval(updateDashboard, 10000); // Update every 10 seconds
    </script>
</body>
</html>
